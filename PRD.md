
# Hotel MDM Pro 交互页面标注规范 (Interaction Specs)

## 1. 酒店列表页 (Hotel List)

**【权限说明】**
*   **查看**: 全员可见。
*   **操作**: “新增”操作创建不同类型数据；列表项操作根据 `SourceType` 区分进入只读或编辑视图。

**1.1 筛选条件**
*   **关键词**: 支持 ID、中英文名称、地址模糊搜索。输入后需点击查询触发。
*   **城市/星级**: 标准下拉筛选。
*   **数据来源 (Source)**:
    *   **全部**: 默认。
    *   **系统同步 (L3)**: 筛选 OTA/Switch/PMS 接口自动创建的数据。
    *   **业务录入 (L4)**: 筛选人工录入数据。
*   **数据状态 (Status)**:
    *   **数据正常**: 筛选**无数据冲突**的酒店数据（包含已上架和筹备中）。
    *   **冲突待决**: 筛选 `conflict=true` 且 `sourceType=L4` 的数据，需人工介入。

**1.2 列表展示**
*   **标识区分**:
    *   **L3**: 灰色标签，图标 Globe，文案“系统同步”。
    *   **L4**: 蓝色标签，图标 Users，文案“业务录入”。
*   **数据状态 (回显与筛选一致)**:
    *   **数据正常**: 绿色标识，表示数据治理状态健康。
    *   **冲突待决**: 琥珀色标识 + 警告图标，表示存在 L4 冲突待解决。
    *   *注：列表页不显示“待保存”状态，该状态仅存在于详情页编辑过程中。*

**1.3 新增酒店弹窗 (AddResourceModal)**
*   **双库检索**: 输入关键词停止 400ms 后（Debounce），同时检索**内部库**和**外部渠道库**。
*   **结果处理**:
    *   **命中内部库**: 显示“已录入”标签 + [查看] 按钮。点击跳转详情页，**阻断重复创建**。
    *   **命中外部库**: 显示“外部信源”标签 + [导入] 按钮。点击创建 **L3 类型**数据，基础信息/政策/设施**锁定**，数据状态“待保存”。
    *   **无结果**: 显示空状态 + [直接手动录入] 按钮。点击创建 **L4 类型**数据，全字段**开放**，数据状态“待保存”。

---

## 2. 酒店详情页 - 基础信息 (Basic Info)

**【权限说明】**
*   **L3 (系统同步)**: 全字段 `readOnly` 或 `disabled`，背景色灰色。禁止修改任何基础属性。
*   **L4 (业务录入)**: 全字段可编辑，背景色白色。支持冲突解决。

**2.1 布局与导航**
*   **顶栏**: 显示酒店名称、来源标签 (L3/L4)、ID 及最后更新时间。
*   **底栏**: 常驻显示数据状态、取消及保存按钮。

**2.2 地址模块交互规范 (Address Logic)**
> 核心设计：采用 **4列平铺 + 级联联动 + 混合输入(Combobox)** 模式，解决行政区划数据缺失问题。

| 字段层级 | 字段名称 | 组件类型 | 必填性逻辑 | 交互与触发规则 |
| :--- | :--- | :--- | :--- | :--- |
| **基础触发层** | **国家/地区** | 下拉选择 (Select) | **全局必填** | • 变更时：清空下级所有字段（省/市/区），重置省份下拉数据。<br>• 示例：中国 / 日本 / 英国 |
| **一级区划层** | **省/州/大区** | 混合输入 (Combobox) | **境内必填**<br>境外选填 | • 变更时：清空下级字段（市/区），重置城市下拉数据。<br>• **混合模式**：下拉列表无选项时，支持直接输入保存。<br>• 示例：上海市 / 东京都 / 大伦敦 |
| **二级区划层** | **城市/市/区域** | 混合输入 (Combobox) | **全局必填** | • 变更时：清空下级字段（区），重置区域下拉数据。<br>• 核心定位字段，必须准确。<br>• 示例：上海市 / 大阪市 / 伦敦 |
| **三级区划层** | **区/县/行政区** | 混合输入 (Combobox) | **境内必填**<br>境外选填 | • 变更时：无下级联动。<br>• 境外部分核心城市（如伦敦、东京）建议填写以提升定位精度。<br>• 示例：黄浦区 / 新宿区 / 威斯敏斯特 |
| **详细地址层** | **详细地址** | 文本输入 (Input) | **全局必填** | • 包含街道、门牌号、楼宇信息。<br>• 失去焦点(Blur)时触发**智能排重校验**。<br>• 示例：南京东路20号 |

**2.3 其他字段交互**
*   **冲突处理 (仅 L4)**:
    *   当字段检测到 `conflict=true` 时，Label 旁显示“差异待决”气泡。
    *   点击气泡弹出对比卡片，支持“采纳系统值”或“保留业务值”。
*   **地图选点**:
    *   L3: 坐标只读。
    *   L4: 坐标可编辑，支持通过 `MapPickerModal` 选点回填经纬度（GCJ-02坐标系）。

**2.4 智能校验 (Smart Validation)**
*   **名称/地址 实时排重**:
    *   **触发**: 当 [酒店名称] 或 [酒店地址] 输入完成并**失去焦点 (OnBlur)** 时。
    *   **逻辑**: 后端检索名称相似度或 GIS 临近度。
    *   **反馈**:
        *   命中内部库 -> 提示 "系统检测到同名/同地址酒店（ID: xxx），状态：[已上线]" -> 按钮 **[去查看]**。
        *   命中外部库 -> 提示 "系统检测到全网渠道存在匹配资源" -> 按钮 **[一键导入]**。

---

## 3. 酒店详情页 - 房型管理 (Room Management)

**【权限说明】**
*   **L3 房型**: 列表卡片及详情抽屉内所有字段**只读**。禁止删除。
*   **L4 房型**: 列表卡片及详情抽屉内所有字段**可编辑**。支持删除。

**3.1 列表视图**
*   **展示**: 卡片式布局，左侧缩略图，右侧信息。
*   **标签**: 房型名称旁标记来源（L3灰色/L4蓝色）。若 L4 开启了实时同步，额外增加“实时同步”绿色标签。

**3.2 房型详情抽屉 (RoomDetailDrawer)**
*   **同步开关 (仅 L4)**:
    *   显示“实时同步系统更新数据”复选框。
    *   **勾选**: 允许系统 Job 更新覆盖此房型数据。
    *   **未勾选**: 保护模式，忽略系统更新，保留人工编辑值。
*   **字段逻辑**:
    *   **入住人数**: 统一为“最大入住人数”数字字段。
    *   **面积**: 支持切换“固定值”与“范围值”。
    *   **床型**: 结构化数据，支持“OR (方案)”与“AND (组合)”逻辑。

**3.3 智能校验 (Smart Validation - New)**
*   **触发**: 点击抽屉内的 **[保存]** 按钮时。
*   **校验指纹**: **[面积] + [床型] + [窗户] + [楼层]** (联合校验)。
*   **逻辑**: 若当前酒店下已存在上述 4 项字段完全匹配的房型（无论 L3 还是 L4）。
*   **反馈**: Toast 警告 "系统检测到同房型信息（[已存房型名]）已存在，建议复用"。

---

## 4. 酒店详情页 - 政策与设施 (Policies & Facilities)

**【权限说明】**
*   **L3**: 政策字段只读，设施 Checkbox 全部禁用 (Disabled)。
*   **L4**: 政策字段可编辑，设施 Checkbox 可交互。

**4.1 接待与入离**
*   **可接待人群**: 强制使用下拉选择（接待外宾/仅接待大陆和港澳台/仅接待大陆），禁止自由文本。
*   **时间**: 入离时间及前台服务时间（支持非24小时描述）。

**4.2 设施服务**
*   **交互**: 分组展示 Checkbox（网络/交通/综合等）。

---

## 5. 酒店详情页 - 图片素材 (Images)

**【权限说明】**
*   **L3 图片**: **禁止删除**，**禁止修改类型**。**允许**设为首图。
*   **L4 图片**: **允许删除**，**允许修改类型**，**允许**设为首图。

**5.1 图片管理**
*   **展示**: 混合网格排列。L3 图片 Tag 带锁图标。
*   **首图逻辑**: 任意来源图片均可被标记为 `isMaster=true`。未设置时默认取数组首张。
*   **上传**: 新上传图片默认标记为 **L4** 来源。

---

## 6. 酒店详情页 - 数据治理 (Governance)

**【权限说明】**
*   **全员**: 只读。仅作为操作审计日志展示。

**6.1 日志展示**
*   **内容**: 倒序展示时间轴。包含操作人（系统/员工名）、动作类型（同步/录入/冲突解决）、详情描述。
*   **说明**: 顶部常驻提示栏，解释 L3/L4 数据合并规则。
